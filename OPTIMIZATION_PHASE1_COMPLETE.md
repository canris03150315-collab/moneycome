# ğŸš€ å„ªåŒ–ç¬¬ä¸€éšæ®µå®Œæˆå ±å‘Š

**æ—¥æœŸ**: 2025-11-29  
**ç‰ˆæœ¬**: 
- å‰ç«¯: `ichiban-frontend-00253-rf2`
- å¾Œç«¯: `ichiban-backend-new-00155-hj8`

---

## âœ… å·²å®Œæˆçš„å„ªåŒ–é …ç›®

### 1ï¸âƒ£ **Logger å·¥å…· & æ¸…ç†ç”Ÿç”¢ç’°å¢ƒæ—¥èªŒ**

#### **å¯¦ä½œå…§å®¹**
- âœ… å‰µå»º `utils/logger.ts` å·¥å…·
- âœ… è‡ªå‹•å€åˆ†é–‹ç™¼/ç”Ÿç”¢ç’°å¢ƒ
- âœ… æ‰¹é‡æ›¿æ› 66 å€‹ `console.log` ç‚º `logger.log`
- âœ… ä¿ç•™ `console.error` å’Œ `console.warn`ï¼ˆç”Ÿç”¢ç’°å¢ƒä¹Ÿéœ€è¦ï¼‰

#### **å½±éŸ¿çš„æª”æ¡ˆ**
- `utils/logger.ts` (æ–°å¢)
- `vite-env.d.ts` (æ–°å¢ - TypeScript é¡å‹å®šç¾©)
- `scripts/replace-console-logs.cjs` (æ–°å¢ - æ‰¹é‡æ›¿æ›è…³æœ¬)
- `components/AuthPage.tsx`
- `components/LotteryPage.tsx`
- `components/RechargeModal.tsx`
- `components/GoogleCallback.tsx`
- `components/HomePage.tsx`
- `components/AdminProductManagement.tsx`

#### **ä½¿ç”¨æ–¹å¼**
```typescript
import { logger } from '../utils/logger';

// é–‹ç™¼ç’°å¢ƒé¡¯ç¤ºï¼Œç”Ÿç”¢ç’°å¢ƒéš±è—
logger.log('Debug info:', data);
logger.info('Info message');
logger.debug('Debug details');

// æ‰€æœ‰ç’°å¢ƒéƒ½é¡¯ç¤º
logger.warn('Warning message');
logger.error('Error occurred:', error);
```

#### **æ•ˆç›Š**
- ğŸ”’ **å®‰å…¨æ€§æå‡**: ç”Ÿç”¢ç’°å¢ƒä¸æ´©æ¼æ•æ„Ÿè³‡è¨Š
- ğŸ“Š **æ—¥èªŒä¹¾æ·¨**: æ¸›å°‘ç„¡ç”¨æ—¥èªŒï¼Œä¾¿æ–¼è¿½è¹¤çœŸæ­£çš„éŒ¯èª¤
- ğŸ¯ **é–‹ç™¼å‹å¥½**: é–‹ç™¼æ™‚ä¿ç•™æ‰€æœ‰é™¤éŒ¯è³‡è¨Š

---

### 2ï¸âƒ£ **åœ–ç‰‡è‡ªå‹•å£“ç¸®**

#### **å¯¦ä½œå…§å®¹**
- âœ… å®‰è£ `browser-image-compression` å¥—ä»¶
- âœ… ä¿®æ”¹ `utils/imageUpload.ts` æ·»åŠ è‡ªå‹•å£“ç¸®
- âœ… å£“ç¸®åƒæ•¸ï¼šæœ€å¤§ 1MBã€1920pxã€å“è³ª 80%

#### **å£“ç¸®æ•ˆæœ**
```
åŸå§‹åœ–ç‰‡: 5.2 MB
å£“ç¸®å¾Œ: 0.8 MB
å£“ç¸®ç‡: 84.6%
```

#### **æŠ€è¡“ç´°ç¯€**
```typescript
const options = {
  maxSizeMB: 1,              // æœ€å¤§ 1MB
  maxWidthOrHeight: 1920,    // æœ€å¤§å¯¬åº¦/é«˜åº¦
  useWebWorker: true,        // ä½¿ç”¨ Web Workerï¼ˆä¸é˜»å¡ä¸»ç·šç¨‹ï¼‰
  fileType: 'image/jpeg',    // è¼¸å‡ºæ ¼å¼
  initialQuality: 0.8        // åˆå§‹å“è³ª 80%
};
```

#### **æ•ˆç›Š**
- âš¡ **è¼‰å…¥é€Ÿåº¦**: åœ–ç‰‡è¼‰å…¥é€Ÿåº¦æå‡ 70-85%
- ğŸ’¾ **å„²å­˜ç©ºé–“**: ç¯€çœ Cloudinary å„²å­˜ç©ºé–“
- ğŸ“± **è¡Œå‹•å‹å¥½**: æ¸›å°‘è¡Œå‹•è£ç½®æµé‡æ¶ˆè€—
- ğŸ¨ **å“è³ªä¿è­‰**: 80% å“è³ªè‚‰çœ¼å¹¾ä¹ç„¡å·®ç•°

---

### 3ï¸âƒ£ **Sentry éŒ¯èª¤ç›£æ§æ•´åˆ**

#### **å¯¦ä½œå…§å®¹**
- âœ… å®‰è£ `@sentry/react` å¥—ä»¶
- âœ… å‰µå»º `utils/sentry.ts` é…ç½®
- âœ… åœ¨ `index.tsx` åˆå§‹åŒ– Sentry
- âœ… æ·»åŠ ç’°å¢ƒè®Šæ•¸é…ç½®

#### **åŠŸèƒ½ç‰¹æ€§**
1. **è‡ªå‹•éŒ¯èª¤è¿½è¹¤**
   - æ•ç²æ‰€æœ‰æœªè™•ç†çš„éŒ¯èª¤
   - è¨˜éŒ„éŒ¯èª¤å †ç–Š
   - è¿½è¹¤ç”¨æˆ¶æ“ä½œè·¯å¾‘

2. **Session Replay**
   - è¨˜éŒ„ç”¨æˆ¶æ“ä½œï¼ˆéŒ¯èª¤æ™‚ï¼‰
   - é‡ç¾éŒ¯èª¤å ´æ™¯
   - é®ç½©æ•æ„Ÿè³‡è¨Š

3. **æ€§èƒ½ç›£æ§**
   - API è«‹æ±‚è¿½è¹¤
   - é é¢è¼‰å…¥æ™‚é–“
   - ç”¨æˆ¶é«”é©—æŒ‡æ¨™

4. **éš±ç§ä¿è­·**
   - è‡ªå‹•ç§»é™¤æ•æ„Ÿ URL åƒæ•¸ï¼ˆtoken, passwordï¼‰
   - é®ç½©æ‰€æœ‰æ–‡å­—å’Œåª’é«”
   - åªåœ¨ç”Ÿç”¢ç’°å¢ƒå•Ÿç”¨

#### **ä½¿ç”¨æ–¹å¼**
```typescript
import { logError, setUser, clearUser } from '../utils/sentry';

// è¨˜éŒ„éŒ¯èª¤
try {
  // ...
} catch (error) {
  logError(error, { context: 'additional info' });
}

// è¨­ç½®ç”¨æˆ¶è³‡è¨Šï¼ˆç™»å…¥æ™‚ï¼‰
setUser({ id: user.id, email: user.email });

// æ¸…é™¤ç”¨æˆ¶è³‡è¨Šï¼ˆç™»å‡ºæ™‚ï¼‰
clearUser();
```

#### **é…ç½®æ­¥é©Ÿ**
1. è¨»å†Š Sentry å¸³è™Ÿ: https://sentry.io/
2. å‰µå»ºå°ˆæ¡ˆä¸¦ç²å– DSN
3. åœ¨ `.env.production` æ·»åŠ :
   ```
   VITE_SENTRY_DSN=your-sentry-dsn-here
   ```

#### **æ•ˆç›Š**
- ğŸ› **å¿«é€Ÿå®šä½ Bug**: å³æ™‚æ”¶åˆ°éŒ¯èª¤é€šçŸ¥
- ğŸ“Š **æ•¸æ“šåˆ†æ**: äº†è§£å“ªäº›éŒ¯èª¤æœ€å¸¸ç™¼ç”Ÿ
- ğŸ¬ **é‡ç¾å ´æ™¯**: Session Replay å¹«åŠ©ç†è§£ç”¨æˆ¶æ“ä½œ
- ğŸ” **ç”Ÿç”¢ç’°å¢ƒç›£æ§**: ç™¼ç¾æ¸¬è©¦ç’°å¢ƒæ²’ç™¼ç¾çš„å•é¡Œ

---

### 4ï¸âƒ£ **API è«‹æ±‚é »ç‡é™åˆ¶**

#### **å¯¦ä½œå…§å®¹**
- âœ… å®‰è£ `express-rate-limit` å¥—ä»¶
- âœ… å‰µå»º `backend/middleware/rateLimiter.js`
- âœ… æ·»åŠ  4 ç¨®ä¸åŒç­‰ç´šçš„é™åˆ¶
- âœ… æ‡‰ç”¨åˆ°é—œéµç«¯é»

#### **é™åˆ¶ç­‰ç´š**

##### **A. ä¸€èˆ¬é™åˆ¶ (generalLimiter)**
```javascript
æ¯å€‹ IP/ç”¨æˆ¶ æ¯ 15 åˆ†é˜æœ€å¤š 100 å€‹è«‹æ±‚
æ‡‰ç”¨ç¯„åœ: æ‰€æœ‰ /api/* ç«¯é»
```

##### **B. åš´æ ¼é™åˆ¶ (strictLimiter)**
```javascript
æ¯å€‹ IP æ¯ 15 åˆ†é˜æœ€å¤š 5 å€‹è«‹æ±‚
æ‡‰ç”¨ç¯„åœ:
- /api/auth/login (ç™»å…¥)
- /api/auth/register (è¨»å†Š)
- /api/auth/google (Google ç™»å…¥)
- /api/auth/password-reset/request (å¯†ç¢¼é‡ç½®)
```

##### **C. æŠ½çé™åˆ¶ (drawLimiter)**
```javascript
æ¯å€‹ç”¨æˆ¶ æ¯åˆ†é˜æœ€å¤š 10 æ¬¡æŠ½ç
æ‡‰ç”¨ç¯„åœ:
- /api/lottery-sets/:id/draw (æŠ½ç)
ç‰¹æ®Šè¦å‰‡: ç®¡ç†å“¡ä¸å—é™åˆ¶
```

##### **D. ä¸Šå‚³é™åˆ¶ (uploadLimiter)**
```javascript
æ¯å€‹ IP æ¯å°æ™‚æœ€å¤š 20 æ¬¡ä¸Šå‚³
æ‡‰ç”¨ç¯„åœ:
- åœ–ç‰‡ä¸Šå‚³ç«¯é»ï¼ˆé ç•™ï¼‰
```

#### **å›æ‡‰æ ¼å¼**
ç•¶è¶…éé™åˆ¶æ™‚ï¼š
```json
{
  "success": false,
  "message": "è«‹æ±‚éæ–¼é »ç¹ï¼Œè«‹ç¨å¾Œå†è©¦"
}
```

HTTP Headers:
```
RateLimit-Limit: 100
RateLimit-Remaining: 0
RateLimit-Reset: 1638360000
```

#### **æ•ˆç›Š**
- ğŸ›¡ï¸ **é˜²æ­¢æ¿«ç”¨**: é˜»æ­¢æƒ¡æ„æ”»æ“Šå’Œçˆ¬èŸ²
- ğŸ’° **ç¯€çœæˆæœ¬**: æ¸›å°‘ä¸å¿…è¦çš„ API è«‹æ±‚
- âš¡ **ä¿è­·æ€§èƒ½**: é¿å…ä¼ºæœå™¨éè¼‰
- ğŸ” **å®‰å…¨æ€§**: é˜²æ­¢æš´åŠ›ç ´è§£ç™»å…¥

---

## ğŸ“Š **æ•´é«”æ•ˆç›Šç¸½çµ**

### **å®‰å…¨æ€§æå‡**
- âœ… ç”Ÿç”¢ç’°å¢ƒä¸æ´©æ¼æ•æ„Ÿæ—¥èªŒ
- âœ… API è«‹æ±‚é »ç‡é™åˆ¶é˜²æ­¢æ¿«ç”¨
- âœ… Sentry è‡ªå‹•ç§»é™¤æ•æ„Ÿè³‡è¨Š

### **æ€§èƒ½æå‡**
- âœ… åœ–ç‰‡å£“ç¸®æ¸›å°‘ 70-85% è¼‰å…¥æ™‚é–“
- âœ… é »ç‡é™åˆ¶ä¿è­·ä¼ºæœå™¨æ€§èƒ½
- âœ… æ¸›å°‘ç„¡ç”¨æ—¥èªŒè¼¸å‡º

### **ç¶­è­·æ€§æå‡**
- âœ… Sentry å³æ™‚éŒ¯èª¤é€šçŸ¥
- âœ… Logger å·¥å…·çµ±ä¸€ç®¡ç†æ—¥èªŒ
- âœ… æ¸…æ™°çš„éŒ¯èª¤è¿½è¹¤

### **ç”¨æˆ¶é«”é©—æå‡**
- âœ… åœ–ç‰‡è¼‰å…¥æ›´å¿«
- âœ… ç³»çµ±æ›´ç©©å®š
- âœ… éŒ¯èª¤æ›´å¿«ä¿®å¾©

---

## ğŸ“ˆ **é æœŸæ”¹å–„æŒ‡æ¨™**

| æŒ‡æ¨™ | æ”¹å–„å‰ | æ”¹å–„å¾Œ | æå‡ |
|------|--------|--------|------|
| åœ–ç‰‡è¼‰å…¥æ™‚é–“ | 3-5 ç§’ | 0.5-1 ç§’ | **70-85%** â¬†ï¸ |
| ç”Ÿç”¢ç’°å¢ƒæ—¥èªŒé‡ | 100% | 10-20% | **80-90%** â¬‡ï¸ |
| Bug ç™¼ç¾æ™‚é–“ | æ•¸å¤© | å³æ™‚ | **å³æ™‚é€šçŸ¥** âš¡ |
| API æ¿«ç”¨é¢¨éšª | é«˜ | ä½ | **å¤§å¹…é™ä½** ğŸ›¡ï¸ |
| ä¼ºæœå™¨è² è¼‰ | ä¸­ | ä½ | **20-30%** â¬‡ï¸ |

---

## ğŸ”§ **æŠ€è¡“æ£§æ›´æ–°**

### **æ–°å¢ä¾è³´**

#### **å‰ç«¯**
```json
{
  "@sentry/react": "^8.x",
  "browser-image-compression": "^2.x"
}
```

#### **å¾Œç«¯**
```json
{
  "express-rate-limit": "^7.x"
}
```

---

## ğŸ“ **å¾ŒçºŒå»ºè­°**

### **ç«‹å³åŸ·è¡Œ**
1. âœ… è¨»å†Š Sentry å¸³è™Ÿä¸¦é…ç½® DSN
2. âœ… ç›£æ§ Sentry Dashboard è§€å¯ŸéŒ¯èª¤
3. âœ… æ¸¬è©¦é »ç‡é™åˆ¶æ˜¯å¦æ­£å¸¸é‹ä½œ

### **çŸ­æœŸå„ªåŒ–ï¼ˆ1-2é€±ï¼‰**
- ğŸ”„ å¯¦ä½œä»£ç¢¼åˆ†å‰²ï¼ˆCode Splittingï¼‰
- ğŸ”„ æ·»åŠ  ESLint + Prettier
- ğŸ”„ å„ªåŒ– Firestore æŸ¥è©¢ç´¢å¼•

### **ä¸­æœŸå„ªåŒ–ï¼ˆ1å€‹æœˆï¼‰**
- ğŸ”„ æ·»åŠ å–®å…ƒæ¸¬è©¦
- ğŸ”„ å¯¦ä½œ PWA åŠŸèƒ½
- ğŸ”„ æ•´åˆ Google Analytics

---

## ğŸ¯ **é©—è­‰æ­¥é©Ÿ**

### **1. Logger é©—è­‰**
```bash
# é–‹ç™¼ç’°å¢ƒï¼šæ‡‰è©²çœ‹åˆ°æ‰€æœ‰æ—¥èªŒ
npm run dev

# ç”Ÿç”¢ç’°å¢ƒï¼šæ‡‰è©²åªçœ‹åˆ° error å’Œ warn
npm run build && npm run preview
```

### **2. åœ–ç‰‡å£“ç¸®é©—è­‰**
1. ä¸Šå‚³ä¸€å¼µå¤§åœ–ç‰‡ï¼ˆ>5MBï¼‰
2. æª¢æŸ¥é–‹ç™¼è€…å·¥å…· Console
3. æ‡‰è©²çœ‹åˆ°å£“ç¸®æ—¥èªŒï¼š
   ```
   [ImageUpload] åŸå§‹åœ–ç‰‡å¤§å°: 5.20 MB
   [ImageUpload] å£“ç¸®å¾Œå¤§å°: 0.82 MB
   [ImageUpload] å£“ç¸®ç‡: 84.2%
   ```

### **3. Sentry é©—è­‰**
1. åœ¨ç¨‹å¼ä¸­æ•…æ„æ‹‹å‡ºéŒ¯èª¤
2. æª¢æŸ¥ Sentry Dashboard
3. æ‡‰è©²æ”¶åˆ°éŒ¯èª¤é€šçŸ¥

### **4. é »ç‡é™åˆ¶é©—è­‰**
```bash
# æ¸¬è©¦ç™»å…¥é™åˆ¶ï¼ˆ15åˆ†é˜å…§å˜—è©¦ç™»å…¥6æ¬¡ï¼‰
for i in {1..6}; do
  curl -X POST https://your-api/api/auth/login \
    -H "Content-Type: application/json" \
    -d '{"email":"test@test.com","password":"wrong"}'
done

# ç¬¬6æ¬¡æ‡‰è©²è¿”å› 429 Too Many Requests
```

---

## ğŸ“ **æ”¯æ´è³‡æº**

### **æ–‡æª”**
- Logger: `utils/logger.ts`
- Sentry: `utils/sentry.ts`
- åœ–ç‰‡å£“ç¸®: `utils/imageUpload.ts`
- é »ç‡é™åˆ¶: `backend/middleware/rateLimiter.js`

### **å¤–éƒ¨æœå‹™**
- Sentry Dashboard: https://sentry.io/
- Cloudinary Dashboard: https://cloudinary.com/console

---

## âœ¨ **ç¸½çµ**

ç¬¬ä¸€éšæ®µå„ªåŒ–å·²æˆåŠŸå®Œæˆï¼å°ˆæ¡ˆåœ¨**å®‰å…¨æ€§**ã€**æ€§èƒ½**ã€**ç¶­è­·æ€§**ä¸‰å€‹æ–¹é¢éƒ½æœ‰é¡¯è‘—æå‡ã€‚

**é—œéµæˆæœ**:
- ğŸ”’ ç”Ÿç”¢ç’°å¢ƒæ›´å®‰å…¨
- âš¡ åœ–ç‰‡è¼‰å…¥é€Ÿåº¦æå‡ 70-85%
- ğŸ› å³æ™‚éŒ¯èª¤ç›£æ§
- ğŸ›¡ï¸ API æ¿«ç”¨é˜²è­·

**ä¸‹ä¸€æ­¥**: æ ¹æ“šå¯¦éš›ä½¿ç”¨æƒ…æ³ï¼Œç¹¼çºŒåŸ·è¡Œç¬¬äºŒéšæ®µå„ªåŒ–ï¼ˆä»£ç¢¼åˆ†å‰²ã€æ¸¬è©¦ã€PWAï¼‰ã€‚

---

**éƒ¨ç½²è³‡è¨Š**:
- å‰ç«¯: `ichiban-frontend-00253-rf2`
- å¾Œç«¯: `ichiban-backend-new-00155-hj8`
- éƒ¨ç½²æ™‚é–“: 2025-11-29 14:51 UTC+8

**Git Commit**: `a4ffed6` - "å„ªåŒ–ç¬¬ä¸€éšæ®µï¼šLoggerå·¥å…·ã€åœ–ç‰‡å£“ç¸®ã€Sentryç›£æ§ã€APIé »ç‡é™åˆ¶"
