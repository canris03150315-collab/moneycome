# æ•¸æ“šé·ç§»è…³æœ¬èªªæ˜

## ğŸ“‹ **å¯ç”¨è…³æœ¬**

### **1. add-pool-verification-data.js**
ç‚ºæ‰€æœ‰å•†å“æ·»åŠ å…¬å¹³æ€§é©—è­‰è³‡è¨Š

**ç”¨é€”**ï¼š
- ç‚ºæ–°å•†å“ç”Ÿæˆ poolCommitmentHash å’Œ prizeOrder
- ç‚ºå·²å”®å®Œçš„å•†å“å…¬é–‹ poolSeed

**åŸ·è¡Œ**ï¼š
```bash
node backend/migrations/add-pool-verification-data.js
```

**æ³¨æ„**ï¼š
- åªæœƒè™•ç†æ²’æœ‰é©—è­‰è³‡è¨Šçš„å•†å“
- å·²æœ‰é©—è­‰è³‡è¨Šçš„å•†å“æœƒè¢«è·³é

---

### **2. check-lottery-state.js**
æª¢æŸ¥ç‰¹å®šå•†å“çš„ç‹€æ…‹

**ç”¨é€”**ï¼š
- æŸ¥çœ‹å•†å“çš„å”®å®Œç‹€æ…‹
- æª¢æŸ¥æ˜¯å¦æœ‰ poolSeed
- è¨ºæ–·å•é¡Œ

**åŸ·è¡Œ**ï¼š
```bash
# æª¢æŸ¥ç‰¹å®šå•†å“
node backend/migrations/check-lottery-state.js <å•†å“ID>

# ä¾‹å¦‚
node backend/migrations/check-lottery-state.js set-1764336937045-71euc74
```

**è¼¸å‡ºç¤ºä¾‹**ï¼š
```
æª¢æŸ¥å•†å“: set-1764336937045-71euc74

å•†å“æ¨™é¡Œ: DDD
prizeOrder é•·åº¦: 11
poolCommitmentHash: âœ“ å­˜åœ¨
poolSeed: âœ— ä¸å­˜åœ¨

æŠ½çç‹€æ…‹:
drawnTicketIndices é•·åº¦: 10

å”®å®Œç‹€æ…‹:
å·²æŠ½: 10 / 11 (å‰©é¤˜ 1 å¼µ)
æ˜¯å¦å”®å®Œ: âœ— å¦

- å•†å“æœªå”®å®Œ
```

---

### **3. publish-pool-seed.js**
å…¬é–‹ç±¤æ± ç¨®å­ç¢¼

**ç”¨é€”**ï¼š
- ç‚ºæ¥è¿‘å”®å®Œæˆ–å·²å”®å®Œçš„å•†å“å…¬é–‹ç¨®å­ç¢¼
- æ”¯æŒå–®å€‹å…¬é–‹æˆ–æ‰¹é‡å…¬é–‹

**åŸ·è¡Œ**ï¼š
```bash
# å…¬é–‹ç‰¹å®šå•†å“ï¼ˆå‰©é¤˜ â‰¤ 1 å¼µï¼‰
node backend/migrations/publish-pool-seed.js <å•†å“ID>

# å¼·åˆ¶å…¬é–‹ï¼ˆç„¡è«–å‰©é¤˜å¤šå°‘å¼µï¼‰
node backend/migrations/publish-pool-seed.js <å•†å“ID> --force

# æ‰¹é‡å…¬é–‹æ‰€æœ‰æ¥è¿‘å”®å®Œçš„å•†å“ï¼ˆå‰©é¤˜ â‰¤ 1 å¼µï¼‰
node backend/migrations/publish-pool-seed.js --all
```

**ç¤ºä¾‹**ï¼š
```bash
# å…¬é–‹å–®å€‹å•†å“
node backend/migrations/publish-pool-seed.js set-1764336937045-71euc74

# æ‰¹é‡å…¬é–‹
node backend/migrations/publish-pool-seed.js --all
```

**è¼¸å‡ºç¤ºä¾‹**ï¼š
```
è™•ç†å•†å“: set-1764336937045-71euc74

å•†å“æ¨™é¡Œ: DDD
å”®å®Œç‹€æ…‹: 10 / 11 (å‰©é¤˜ 1 å¼µ)

âœ“ å·²ç”Ÿæˆä¸¦å…¬é–‹ç¨®å­ç¢¼
æ–°çš„ poolCommitmentHash: 65bd0c124e8eeef3...
poolSeed: 96bacf432e38ccf4...
```

---

## ğŸ”„ **å·¥ä½œæµç¨‹**

### **æ–°å•†å“ä¸Šæ¶æ™‚**
1. å•†å“å‰µå»ºæ™‚è‡ªå‹•ç”Ÿæˆé©—è­‰è³‡è¨Šï¼ˆå¦‚æœå¾Œç«¯æ”¯æŒï¼‰
2. æˆ–è€…é‹è¡Œ `add-pool-verification-data.js` æ‰‹å‹•ç”Ÿæˆ

### **å•†å“æ¥è¿‘å”®å®Œæ™‚**
1. ä½¿ç”¨ `check-lottery-state.js` æª¢æŸ¥ç‹€æ…‹
2. å¦‚æœå‰©é¤˜ â‰¤ 1 å¼µï¼Œé‹è¡Œ `publish-pool-seed.js` å…¬é–‹ç¨®å­ç¢¼

### **æ‰¹é‡è™•ç†**
1. é‹è¡Œ `publish-pool-seed.js --all` æ‰¹é‡å…¬é–‹æ‰€æœ‰æ¥è¿‘å”®å®Œçš„å•†å“

---

## âš ï¸ **æ³¨æ„äº‹é …**

### **é—œæ–¼ poolSeed**
- **æ‡‰è©²åœ¨å•†å“å‰µå»ºæ™‚å°±ç”Ÿæˆ**ï¼Œä½†ä¸å…¬é–‹
- **åªåœ¨å”®å®Œå¾Œæ‰å…¬é–‹**
- å¦‚æœå•†å“å‰µå»ºæ™‚æ²’æœ‰ç”Ÿæˆï¼Œ`publish-pool-seed.js` æœƒç”Ÿæˆæ–°çš„ä¸¦æ›´æ–° Hash

### **é—œæ–¼ poolCommitmentHash**
- å¿…é ˆåœ¨é–‹è³£å‰å°±å…¬é–‹
- ç”¨æ–¼è­‰æ˜ç±¤æ± é †åºåœ¨é–‹è³£å‰å·²å›ºå®š
- å¦‚æœå¾Œä¾†æ›´æ–°äº† poolSeedï¼ŒHash ä¹Ÿå¿…é ˆåŒæ­¥æ›´æ–°

### **å”®å®Œåˆ¤æ–·**
- ç³»çµ±åˆ¤æ–·ï¼š`drawnTickets >= totalTickets`
- å¯¦éš›æƒ…æ³ï¼šå¯èƒ½å‰©é¤˜ 1 å¼µï¼ˆæœ€å¾Œè³ï¼‰
- å»ºè­°ï¼šå‰©é¤˜ â‰¤ 1 å¼µæ™‚å°±å¯ä»¥å…¬é–‹ç¨®å­ç¢¼

---

## ğŸ› ï¸ **æ•…éšœæ’é™¤**

### **å•é¡Œï¼šå•†å“å·²å”®å®Œä½†æ²’æœ‰ç¨®å­ç¢¼**
**è§£æ±º**ï¼š
```bash
node backend/migrations/publish-pool-seed.js <å•†å“ID> --force
```

### **å•é¡Œï¼šä¸ç¢ºå®šå•†å“ç‹€æ…‹**
**è§£æ±º**ï¼š
```bash
node backend/migrations/check-lottery-state.js <å•†å“ID>
```

### **å•é¡Œï¼šæ‰¹é‡å…¬é–‹å¤±æ•—**
**è§£æ±º**ï¼š
1. æª¢æŸ¥ Firestore é€£æ¥
2. æª¢æŸ¥æ¬Šé™
3. é€å€‹å•†å“æ‰‹å‹•å…¬é–‹

---

## ğŸ“ **è…³æœ¬åŸ·è¡Œè¨˜éŒ„**

### **2025-11-30**
- âœ… åŸ·è¡Œ `add-pool-verification-data.js` - 6 å€‹å•†å“å·²æ›´æ–°
- âœ… åŸ·è¡Œ `publish-pool-seed.js --all` - 4 å€‹å•†å“å·²å…¬é–‹ç¨®å­ç¢¼
  - set-1764336937045-71euc74 (DDD) - å‰©é¤˜ 1 å¼µ
  - set-1764337070300-a5f3u3s (DDD) - å‰©é¤˜ 1 å¼µ
  - set-1764337259318-u5wilg9 (DDDD) - å‰©é¤˜ 1 å¼µ
  - set-1764337298183-hz1txmz (DDDD) - å‰©é¤˜ 1 å¼µ

---

## ğŸ” **å®‰å…¨æ€§**

- âœ… ç¨®å­ç¢¼åªåœ¨å”®å®Œå¾Œå…¬é–‹
- âœ… Hash åœ¨é–‹è³£å‰å°±å·²å…¬é–‹
- âœ… ç”¨æˆ¶å¯ä»¥é©—è­‰æ•´å€‹éç¨‹çš„å…¬å¹³æ€§
- âœ… æ‰€æœ‰æ“ä½œéƒ½æœ‰æ—¥èªŒè¨˜éŒ„
